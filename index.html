<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitwise Calc Pro</title>
    <style>
        :root {
            --bg-color: #111827;
            --card-bg: #1f2937;
            --text-main: #f3f4f6;
            --text-muted: #9ca3af;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #374151;
            --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 540px;
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-main);
        }

        /* Mode Switcher */
        .mode-switch {
            display: flex;
            background-color: var(--bg-color);
            border-radius: 0.5rem;
            padding: 4px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .mode-btn {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 0.3rem;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background-color: var(--accent);
            color: white;
        }

        /* Inputs Area */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .input-row {
            display: flex;
            flex-direction: column;
        }

        .control-row {
            display: flex;
            gap: 1rem;
        }
        
        .control-item {
            flex: 1;
        }

        label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-weight: 500;
            display: block;
        }

        input[type="text"], select {
            background-color: var(--bg-color);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-family: var(--font-mono);
            width: 100%;
            outline: none;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus, select:focus {
            border-color: var(--accent);
        }

        select {
            font-weight: bold;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        input:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Result Area */
        .result-area {
            background-color: #0f131a;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: auto fit-content(100%) auto; /* Op, Bin, Dec */
            gap: 4px 15px;
            font-family: var(--font-mono);
            font-size: 1rem;
            line-height: 1.5;
        }

        .col-op {
            text-align: right;
            color: var(--accent);
            font-weight: bold;
            min-width: 25px;
        }

        .col-bin {
            text-align: right;
            color: var(--text-main);
            letter-spacing: 2px;
            white-space: pre;
        }

        .col-dec {
            text-align: left;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-left: 5px;
            white-space: nowrap;
        }

        .divider {
            grid-column: 1 / 4;
            border-bottom: 1px solid var(--text-muted);
            margin: 8px 0;
            opacity: 0.5;
        }

        .result-row .col-bin {
            color: var(--accent);
            font-weight: bold;
        }
        
        .result-row .col-dec {
            color: var(--accent);
        }

        @media (max-width: 480px) {
            .container { padding: 1.2rem; }
            .col-bin { font-size: 0.85rem; letter-spacing: 0.5px; }
            .col-dec { font-size: 0.75rem; }
            .control-row { gap: 0.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Bitwise Calc Pro</h1>

    <div class="mode-switch">
        <button class="mode-btn active" id="btn-bin" onclick="setMode('BIN')">Binary (2진수)</button>
        <button class="mode-btn" id="btn-dec" onclick="setMode('DEC')">Decimal (10진수)</button>
    </div>

    <div class="input-group">
        <div class="control-row">
            <div class="control-item input-row">
                <label for="byteSize">데이터 크기</label>
                <select id="byteSize">
                    <!-- 기본값 1 Byte로 설정 (selected) -->
                    <option value="8" selected>1 Byte (8-bit)</option>
                    <option value="16">2 Bytes (16-bit)</option>
                    <option value="32">4 Bytes (32-bit)</option>
                    <option value="64">8 Bytes (64-bit)</option>
                </select>
            </div>
            <div class="control-item input-row">
                <label for="operator">연산자</label>
                <select id="operator">
                    <option value="&">AND (&amp;)</option>
                    <option value="|">OR (&#124;)</option>
                    <option value="^">XOR (^)</option>
                    <option value="~">NOT (~)</option>
                    <option value="<<">L-Shift (&lt;&lt;)</option>
                    <option value=">>">R-Shift (&gt;&gt;)</option>
                </select>
            </div>
        </div>

        <div class="input-row">
            <label for="inputA">값 A</label>
            <input type="text" id="inputA" placeholder="0" autocomplete="off">
        </div>

        <div class="input-row" id="row-inputB">
            <label for="inputB">값 B</label>
            <input type="text" id="inputB" placeholder="0" autocomplete="off">
        </div>
    </div>

    <div class="result-area">
        <div class="calc-grid" id="calc-output">
            <div style="grid-column: 1/4; text-align: center; color: #666;">
                값을 입력하면 실시간으로 계산됩니다
            </div>
        </div>
    </div>
</div>

<script>
    let currentMode = 'BIN'; 
    
    const inputA = document.getElementById('inputA');
    const inputB = document.getElementById('inputB');
    const operator = document.getElementById('operator');
    const byteSize = document.getElementById('byteSize');
    const rowInputB = document.getElementById('row-inputB');
    const outputDiv = document.getElementById('calc-output');
    const btnBin = document.getElementById('btn-bin');
    const btnDec = document.getElementById('btn-dec');

    function init() {
        inputA.addEventListener('input', handleInput);
        inputB.addEventListener('input', handleInput);
        operator.addEventListener('change', () => {
            handleOperatorChange();
            calculate();
        });
        byteSize.addEventListener('change', calculate);
        
        handleOperatorChange(); 
    }

    function handleInput(e) {
        const el = e.target;
        if (currentMode === 'BIN') {
            el.value = el.value.replace(/[^01]/g, '');
        } else {
            el.value = el.value.replace(/[^0-9]/g, '');
        }
        calculate();
    }

    function handleOperatorChange() {
        const op = operator.value;
        if (op === '~') {
            inputB.disabled = true;
            inputB.value = '';
            rowInputB.style.opacity = '0.5';
        } else {
            inputB.disabled = false;
            rowInputB.style.opacity = '1';
        }
    }

    function setMode(mode) {
        if (currentMode === mode) return;
        
        convertValue(inputA, currentMode, mode);
        convertValue(inputB, currentMode, mode);

        currentMode = mode;

        if (mode === 'BIN') {
            btnBin.classList.add('active');
            btnDec.classList.remove('active');
            inputA.placeholder = "0 또는 1";
            inputB.placeholder = "0 또는 1";
        } else {
            btnDec.classList.add('active');
            btnBin.classList.remove('active');
            inputA.placeholder = "0-9";
            inputB.placeholder = "0-9";
        }
        calculate();
    }

    function convertValue(el, from, to) {
        if (!el.value) return;
        try {
            let val;
            if (from === 'BIN') val = BigInt(`0b${el.value}`);
            else val = BigInt(el.value);
            
            if (to === 'BIN') el.value = val.toString(2);
            else el.value = val.toString(10);
        } catch (e) {
            el.value = "";
        }
    }

    function calculate() {
        const op = operator.value;
        const bits = parseInt(byteSize.value);
        const bitsBI = BigInt(bits);
        // 마스크: 해당 비트 수만큼 1로 채움 (예: 8bit -> 255)
        const mask = (1n << bitsBI) - 1n;

        let valA = inputA.value;
        let valB = inputB.value;

        if (!valA && (!valB && op !== '~')) {
            outputDiv.innerHTML = '<div style="grid-column: 1/4; text-align: center; color: #666;">값을 입력하세요</div>';
            return;
        }

        try {
            let bigA = 0n, bigB = 0n;

            if (valA) bigA = currentMode === 'BIN' ? BigInt(`0b${valA}`) : BigInt(valA);
            if (valB) bigB = currentMode === 'BIN' ? BigInt(`0b${valB}`) : BigInt(valB);

            // 입력값 마스킹 (선택된 데이터 크기 초과분 절삭)
            const maskedA = bigA & mask;
            const maskedB = bigB & mask;

            let result = 0n;

            switch (op) {
                case '&': result = maskedA & maskedB; break;
                case '|': result = maskedA | maskedB; break;
                case '^': result = maskedA ^ maskedB; break;
                case '~': result = ~maskedA; break;
                case '<<': result = maskedA << maskedB; break;
                case '>>': result = maskedA >> maskedB; break;
            }

            // 결과값 마스킹
            const finalResult = result & mask;

            render(op, maskedA, maskedB, finalResult, bits);

        } catch (e) {
            // console.error(e);
        }
    }

    function render(op, a, b, res, bits) {
        let html = '';

        if (op === '~') {
            html += createRow('', a, bits);
            html += `<div class="col-op">${op}</div><div class="col-bin"></div><div class="col-dec"></div>`;
        } else {
            html += createRow('', a, bits);
            html += createRow(op, b, bits);
        }

        html += `<div class="divider"></div>`;
        html += createRow('=', res, bits, true);
        
        outputDiv.innerHTML = html;
    }

    function createRow(opSymbol, val, bits, isResult = false) {
        let binStr = val.toString(2);
        
        // 0 패딩 (앞자리 채우기)
        if (binStr.length < bits) {
            binStr = binStr.padStart(bits, '0');
        }

        // 4비트 단위로 끊어서 보여주기
        const formattedBin = binStr.replace(/(?=(?:.{4})+$)/g, ' ');

        const decStr = isResult ? `= ${val.toString(10)}` : `(${val.toString(10)})`;
        const rowClass = isResult ? 'result-row' : '';

        return `
            <div class="col-op ${rowClass}">${opSymbol}</div>
            <div class="col-bin ${rowClass}">${formattedBin}</div>
            <div class="col-dec ${rowClass}">${decStr}</div>
        `;
    }

    init();
</script>

</body>
</html>
